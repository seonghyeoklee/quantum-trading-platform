<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í‚¤ì›€ ì‹¤ì‹œê°„ ì‹œì„¸ WebSocket í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .status.connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-primary {
            background: #007bff;
            color: white;
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        .logs {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 4px;
            height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .stock-data {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stock-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: white;
        }
        .stock-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .price-info {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }
        .price-up {
            color: #e74c3c;
        }
        .price-down {
            color: #3498db;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ í‚¤ì›€ ì‹¤ì‹œê°„ ì‹œì„¸ WebSocket í…ŒìŠ¤íŠ¸</h1>
        
        <div id="connectionStatus" class="status disconnected">
            ì—°ê²° ìƒíƒœ: ëŠì–´ì§
        </div>

        <div class="controls">
            <button onclick="connect()" class="btn-primary">WebSocket ì—°ê²°</button>
            <button onclick="disconnect()" class="btn-danger">ì—°ê²° í•´ì œ</button>
            <button onclick="clearLogs()" class="btn-secondary">ë¡œê·¸ ì§€ìš°ê¸°</button>
        </div>

        <div class="subscription-panel" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0;">
            <h3>ğŸ“Š ì¢…ëª© êµ¬ë… ê´€ë¦¬</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; align-items: end; margin: 15px 0;">
                <div>
                    <label>ì¢…ëª© ì½”ë“œ:</label>
                    <input type="text" id="stockCode" placeholder="ì˜ˆ: 005930,000660" 
                           style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    <small style="color: #666;">ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì—¬ ì—¬ëŸ¬ ì¢…ëª© ì…ë ¥</small>
                </div>
                <div>
                    <label>ë°ì´í„° íƒ€ì…:</label>
                    <select id="dataTypes" multiple style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="0A" selected>0A (ì£¼ì‹í˜¸ê°€)</option>
                        <option value="0B" selected>0B (ì£¼ì‹ì²´ê²°)</option>
                        <option value="0C">0C (ì˜ˆìƒì²´ê²°)</option>
                        <option value="0D">0D (ì˜ˆìƒí˜¸ê°€)</option>
                        <option value="0E">0E (íˆ¬ììë³„ë§¤ë§¤ë™í–¥)</option>
                    </select>
                    <small style="color: #666;">Ctrl+í´ë¦­ìœ¼ë¡œ ë‹¤ì¤‘ ì„ íƒ</small>
                </div>
                <div style="display: flex; gap: 5px;">
                    <button onclick="subscribeStocks()" class="btn-primary">êµ¬ë…</button>
                    <button onclick="unsubscribeAll()" class="btn-danger">ì „ì²´í•´ì§€</button>
                </div>
            </div>
            
            <div style="margin-top: 15px;">
                <h4>ğŸ“ˆ í¬íŠ¸í´ë¦¬ì˜¤ ë¹ ë¥¸ ì„ íƒ:</h4>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
                    <button onclick="subscribePortfolio('big5')" class="btn-primary">ğŸ† ëŒ€í˜•ì£¼ TOP 5</button>
                    <button onclick="subscribePortfolio('tech')" class="btn-primary">ğŸ’» í…Œí¬ì£¼</button>
                    <button onclick="subscribePortfolio('bio')" class="btn-primary">ğŸ§¬ ë°”ì´ì˜¤</button>
                    <button onclick="subscribePortfolio('battery')" class="btn-primary">ğŸ”‹ ë°°í„°ë¦¬</button>
                </div>
                
                <h4 style="margin-top: 15px;">ê°œë³„ ì¢…ëª© ì„ íƒ:</h4>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
                    <button onclick="quickSubscribe('005930', 'ì‚¼ì„±ì „ì')" class="btn-secondary">ì‚¼ì„±ì „ì</button>
                    <button onclick="quickSubscribe('000660', 'SKí•˜ì´ë‹‰ìŠ¤')" class="btn-secondary">SKí•˜ì´ë‹‰ìŠ¤</button>
                    <button onclick="quickSubscribe('373220', 'LGì—ë„ˆì§€ì†”ë£¨ì…˜')" class="btn-secondary">LGì—ë„ˆì§€ì†”ë£¨ì…˜</button>
                    <button onclick="quickSubscribe('207940', 'ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤')" class="btn-secondary">ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤</button>
                    <button onclick="quickSubscribe('005380', 'í˜„ëŒ€ì°¨')" class="btn-secondary">í˜„ëŒ€ì°¨</button>
                    <button onclick="quickSubscribe('035420', 'NAVER')" class="btn-secondary">NAVER</button>
                    <button onclick="quickSubscribe('035720', 'ì¹´ì¹´ì˜¤')" class="btn-secondary">ì¹´ì¹´ì˜¤</button>
                </div>
            </div>
        </div>

        <div class="stock-data" id="stockData">
            <!-- ì‹¤ì‹œê°„ ì£¼ì‹ ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
        </div>

        <h3>ì‹¤ì‹œê°„ ë¡œê·¸</h3>
        <div id="logs" class="logs"></div>
    </div>

    <script>
        let websocket = null;
        let stockData = {};

        function addLog(message, type = 'info') {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString('ko-KR');
            const color = type === 'error' ? '#f00' : type === 'success' ? '#0f0' : '#fff';
            logs.innerHTML += `<div style="color: ${color};">[${timestamp}] ${message}</div>`;
            logs.scrollTop = logs.scrollHeight;
        }

        function updateConnectionStatus(connected) {
            const status = document.getElementById('connectionStatus');
            if (connected) {
                status.className = 'status connected';
                status.textContent = 'ì—°ê²° ìƒíƒœ: ì—°ê²°ë¨ âœ…';
            } else {
                status.className = 'status disconnected';
                status.textContent = 'ì—°ê²° ìƒíƒœ: ëŠì–´ì§ âŒ';
            }
        }

        function connect() {
            if (websocket && websocket.readyState === WebSocket.OPEN) {
                addLog('ì´ë¯¸ ì—°ê²°ë˜ì–´ ìˆìŠµë‹ˆë‹¤.', 'info');
                return;
            }

            // í˜„ì¬ í¬íŠ¸ê°€ 8100ì´ë¯€ë¡œ ëª…ì‹œì ìœ¼ë¡œ ì„¤ì •
            const wsUrl = `ws://127.0.0.1:8100/ws/realtime`;
            addLog(`WebSocket ì—°ê²° ì‹œë„: ${wsUrl}`, 'info');

            try {
                websocket = new WebSocket(wsUrl);
            } catch (error) {
                addLog(`WebSocket ìƒì„± ì˜¤ë¥˜: ${error.message}`, 'error');
                return;
            }

            websocket.onopen = function(event) {
                addLog('WebSocket ì—°ê²° ì„±ê³µ! ğŸ‰', 'success');
                updateConnectionStatus(true);
            };

            websocket.onmessage = function(event) {
                try {
                    const data = JSON.parse(event.data);
                    
                    if (data.type === 'status') {
                        addLog(`ìƒíƒœ: ${data.message}`, 'info');
                    } else if (data.type === 'realtime_data') {
                        handleRealtimeData(data.data);
                    } else if (data.type === 'kiwoom_realtime') {
                        handleKiwoomRealtime(data);
                    } else if (data.trnm === 'REG') {
                        handleRegistrationResponse(data);
                    } else if (data.trnm === 'REMOVE') {
                        handleRemovalResponse(data);
                    } else {
                        addLog(`ìˆ˜ì‹ : ${JSON.stringify(data)}`, 'info');
                    }
                } catch (e) {
                    addLog(`ë©”ì‹œì§€ íŒŒì‹± ì˜¤ë¥˜: ${event.data}`, 'error');
                }
            };

            websocket.onclose = function(event) {
                const reason = event.reason || 'ì•Œ ìˆ˜ ì—†ëŠ” ì´ìœ ';
                const code = event.code;
                addLog(`WebSocket ì—°ê²° ì¢…ë£Œ (ì½”ë“œ: ${code}, ì´ìœ : ${reason})`, 'error');
                updateConnectionStatus(false);
                websocket = null;
                
                // ìë™ ì¬ì—°ê²° (5ì´ˆ í›„)
                if (!event.wasClean) {
                    addLog('5ì´ˆ í›„ ìë™ ì¬ì—°ê²° ì‹œë„...', 'info');
                    setTimeout(connect, 5000);
                }
            };

            websocket.onerror = function(error) {
                addLog(`WebSocket ì˜¤ë¥˜: ${error.type || error}`, 'error');
                updateConnectionStatus(false);
            };
        }

        function disconnect() {
            if (websocket) {
                websocket.close();
                addLog('WebSocket ì—°ê²°ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.', 'info');
            }
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }

        function handleRealtimeData(data) {
            // ì‹¤ì‹œê°„ ë°ì´í„° ì²˜ë¦¬
            if (data && data.data && Array.isArray(data.data)) {
                data.data.forEach(item => {
                    const stockCode = item.item;
                    const dataType = item.type;
                    const values = item.values || {};

                    if (dataType === '0B') { // ì£¼ì‹ì²´ê²°
                        updateStockCard(stockCode, values);
                        addLog(`ğŸ“ˆ [${stockCode}] ì²´ê²°: ${values['10']}ì›`, 'success');
                    } else if (dataType === '0A') { // ì£¼ì‹í˜¸ê°€
                        addLog(`ğŸ“Š [${stockCode}] í˜¸ê°€ ì—…ë°ì´íŠ¸`, 'info');
                    }
                });
            }
        }

        function updateStockCard(stockCode, values) {
            const stockDataDiv = document.getElementById('stockData');
            let card = document.getElementById(`stock_${stockCode}`);
            
            if (!card) {
                card = document.createElement('div');
                card.className = 'stock-card';
                card.id = `stock_${stockCode}`;
                stockDataDiv.appendChild(card);
            }

            const stockName = getStockName(stockCode);
            const currentPrice = values['10'] || 'N/A';
            const priceChange = values['11'] || '0';
            const changeRate = values['12'] || '0%';
            const volume = values['15'] || 'N/A';

            const priceClass = priceChange.startsWith('+') ? 'price-up' : 
                              priceChange.startsWith('-') ? 'price-down' : '';

            card.innerHTML = `
                <div class="stock-name">${stockName} (${stockCode})</div>
                <div class="price-info">
                    <span>í˜„ì¬ê°€:</span>
                    <span class="${priceClass}">${currentPrice}ì›</span>
                </div>
                <div class="price-info">
                    <span>ì „ì¼ëŒ€ë¹„:</span>
                    <span class="${priceClass}">${priceChange} (${changeRate})</span>
                </div>
                <div class="price-info">
                    <span>ê±°ë˜ëŸ‰:</span>
                    <span>${volume}ì£¼</span>
                </div>
            `;
        }

        function getStockName(stockCode) {
            const stockNames = {
                // ëŒ€í˜•ì£¼ TOP 5
                '005930': 'ì‚¼ì„±ì „ì',
                '000660': 'SKí•˜ì´ë‹‰ìŠ¤',
                '373220': 'LGì—ë„ˆì§€ì†”ë£¨ì…˜',
                '207940': 'ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤',
                '005380': 'í˜„ëŒ€ì°¨',
                
                // ì¶”ê°€ ëŒ€í˜•ì£¼
                '006400': 'ì‚¼ì„±SDI',
                '051910': 'LGí™”í•™',
                '068270': 'ì…€íŠ¸ë¦¬ì˜¨',
                
                // í…Œí¬ì£¼
                '035420': 'NAVER',
                '035720': 'ì¹´ì¹´ì˜¤',
                '036570': 'ì—”ì”¨ì†Œí”„íŠ¸',
                '051900': 'LGìƒí™œê±´ê°•',
                
                // ë°”ì´ì˜¤
                '196170': 'ì•Œí…Œì˜¤ì  ',
                '326030': 'SKë°”ì´ì˜¤íŒœ',
                '302440': 'ì§€ì”¨ì…€',
                
                // ë°°í„°ë¦¬/í™”í•™
                '096770': 'SKì´ë…¸ë² ì´ì…˜',
                '066970': 'ì—˜ì•¤ì—í”„',
                
                // ê¸°íƒ€ ì£¼ìš” ì¢…ëª©
                '017670': 'SKí…”ë ˆì½¤',
                '030200': 'KT',
                '003550': 'LG',
                '028260': 'ì‚¼ì„±ë¬¼ì‚°',
                '000270': 'ê¸°ì•„',
                '012330': 'í˜„ëŒ€ëª¨ë¹„ìŠ¤'
            };
            return stockNames[stockCode] || `ì¢…ëª©${stockCode}`;
        }

        // í‚¤ì›€ ì‹¤ì‹œê°„ ì›ë³¸ ë°ì´í„° ì²˜ë¦¬
        function handleKiwoomRealtime(data) {
            const original = data.original_data;
            const trnm = original.trnm;

            if (trnm === 'REAL') {
                // ì‹¤ì‹œê°„ ë°ì´í„° ì²˜ë¦¬
                const realData = original.data || [];
                realData.forEach(item => {
                    const stockCode = item.item;
                    const dataType = item.type;
                    const values = item.values || {};

                    if (dataType === '0B') {
                        // ì£¼ì‹ì²´ê²° ë°ì´í„°
                        updateStockCardFromKiwoom(stockCode, values, 'ì²´ê²°');
                        addLog(`ğŸ“ˆ [${getStockName(stockCode)}(${stockCode})] ì²´ê²°: ${values['10']}ì›`, 'success');
                    } else if (dataType === '0A') {
                        // ì£¼ì‹í˜¸ê°€ ë°ì´í„°
                        addLog(`ğŸ“Š [${getStockName(stockCode)}(${stockCode})] í˜¸ê°€ ì—…ë°ì´íŠ¸`, 'info');
                    }
                });
            } else if (trnm === 'PONG') {
                // PING/PONG ë©”ì‹œì§€ëŠ” ë¡œê·¸ë§Œ
                addLog(`ğŸ’“ í‚¤ì›€ ì„œë²„ PONG ìˆ˜ì‹ `, 'info');
            } else {
                addLog(`ğŸ“¡ í‚¤ì›€ ë©”ì‹œì§€: ${trnm}`, 'info');
            }
        }

        // í‚¤ì›€ ì›ë³¸ ë°ì´í„°ë¡œ ì£¼ì‹ ì¹´ë“œ ì—…ë°ì´íŠ¸
        function updateStockCardFromKiwoom(stockCode, values, dataType) {
            const stockDataDiv = document.getElementById('stockData');
            let card = document.getElementById(`stock_${stockCode}`);
            
            if (!card) {
                card = document.createElement('div');
                card.className = 'stock-card';
                card.id = `stock_${stockCode}`;
                stockDataDiv.appendChild(card);
            }

            const stockName = getStockName(stockCode);
            const currentPrice = values['10'] || 'N/A';
            const priceChange = values['11'] || '0';
            const changeRate = values['12'] || '0%';
            const volume = values['15'] || 'N/A';
            const cumulativeVolume = values['13'] || 'N/A';

            const priceClass = priceChange.startsWith('+') ? 'price-up' : 
                              priceChange.startsWith('-') ? 'price-down' : '';

            card.innerHTML = `
                <div class="stock-name">${stockName} (${stockCode})</div>
                <div class="price-info">
                    <span>í˜„ì¬ê°€:</span>
                    <span class="${priceClass}">${currentPrice ? `${parseInt(currentPrice).toLocaleString()}ì›` : 'N/A'}</span>
                </div>
                <div class="price-info">
                    <span>ì „ì¼ëŒ€ë¹„:</span>
                    <span class="${priceClass}">${priceChange} (${changeRate})</span>
                </div>
                <div class="price-info">
                    <span>ê±°ë˜ëŸ‰:</span>
                    <span>${volume ? parseInt(volume).toLocaleString() : 'N/A'}ì£¼</span>
                </div>
                <div class="price-info">
                    <span>ëˆ„ì ê±°ë˜ëŸ‰:</span>
                    <span>${cumulativeVolume ? parseInt(cumulativeVolume).toLocaleString() : 'N/A'}ì£¼</span>
                </div>
                <div style="font-size: 12px; color: #666; margin-top: 5px;">
                    ë°ì´í„°íƒ€ì…: ${dataType} | ì—…ë°ì´íŠ¸: ${new Date().toLocaleTimeString()}
                </div>
            `;
        }

        // ì¢…ëª© êµ¬ë… í•¨ìˆ˜
        function subscribeStocks() {
            if (!websocket || websocket.readyState !== WebSocket.OPEN) {
                addLog('WebSocketì´ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', 'error');
                return;
            }

            const stockCodeInput = document.getElementById('stockCode').value.trim();
            const dataTypesSelect = document.getElementById('dataTypes');
            
            if (!stockCodeInput) {
                addLog('ì¢…ëª© ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”', 'error');
                return;
            }

            const stockCodes = stockCodeInput.split(',').map(code => code.trim()).filter(code => code);
            const selectedTypes = Array.from(dataTypesSelect.selectedOptions).map(option => option.value);

            if (selectedTypes.length === 0) {
                addLog('ë°ì´í„° íƒ€ì…ì„ ì„ íƒí•˜ì„¸ìš”', 'error');
                return;
            }

            const regMessage = {
                command: 'REG',
                grp_no: '1',
                refresh: '0',  // ê¸°ì¡´ êµ¬ë… í•´ì§€í•˜ê³  ìƒˆë¡œìš´ ì¢…ëª©ë§Œ êµ¬ë…
                data: [{
                    item: stockCodes,
                    type: selectedTypes
                }]
            };

            websocket.send(JSON.stringify(regMessage));
            addLog(`ğŸ“Š ì¢…ëª© êµ¬ë… ìš”ì²­: ${stockCodes.join(', ')} -> ${selectedTypes.join(', ')}`, 'info');
        }

        // ë¹ ë¥¸ êµ¬ë… í•¨ìˆ˜
        function quickSubscribe(stockCode, stockName) {
            document.getElementById('stockCode').value = stockCode;
            addLog(`ğŸš€ ${stockName}(${stockCode}) ë¹ ë¥¸ ì„ íƒ`, 'info');
            subscribeStocks();
        }

        // í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ë…
        function subscribePortfolio(portfolioType) {
            if (!websocket || websocket.readyState !== WebSocket.OPEN) {
                addLog('WebSocketì´ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', 'error');
                return;
            }

            const portfolios = {
                'big5': {
                    name: 'ëŒ€í˜•ì£¼ TOP 5',
                    stocks: ['005930', '000660', '373220', '207940', '005380'],
                    emoji: 'ğŸ†'
                },
                'tech': {
                    name: 'í…Œí¬ì£¼',
                    stocks: ['005930', '035420', '035720', '036570', '051900'],
                    emoji: 'ğŸ’»'
                },
                'bio': {
                    name: 'ë°”ì´ì˜¤',
                    stocks: ['207940', '068270', '196170', '326030', '302440'],
                    emoji: 'ğŸ§¬'
                },
                'battery': {
                    name: 'ë°°í„°ë¦¬',
                    stocks: ['373220', '006400', '051910', '096770', '066970'],
                    emoji: 'ğŸ”‹'
                }
            };

            const portfolio = portfolios[portfolioType];
            if (!portfolio) {
                addLog('ì•Œ ìˆ˜ ì—†ëŠ” í¬íŠ¸í´ë¦¬ì˜¤ íƒ€ì…ì…ë‹ˆë‹¤', 'error');
                return;
            }

            const regMessage = {
                command: 'REG',
                grp_no: '1',
                refresh: '0',
                data: [{
                    item: portfolio.stocks,
                    type: ['0B']  // ì²´ê²° ë°ì´í„°ë§Œ
                }]
            };

            websocket.send(JSON.stringify(regMessage));
            addLog(`${portfolio.emoji} ${portfolio.name} í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ë…: ${portfolio.stocks.length}ê°œ ì¢…ëª©`, 'success');
            
            // UI ì…ë ¥ì°½ë„ ì—…ë°ì´íŠ¸
            document.getElementById('stockCode').value = portfolio.stocks.join(',');
        }

        // ì „ì²´ êµ¬ë… í•´ì§€
        function unsubscribeAll() {
            if (!websocket || websocket.readyState !== WebSocket.OPEN) {
                addLog('WebSocketì´ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', 'error');
                return;
            }

            const removeMessage = {
                command: 'REMOVE',
                grp_no: '1',
                data: [] // ë¹ˆ ë°°ì—´ì´ë©´ ì „ì²´ í•´ì§€
            };

            websocket.send(JSON.stringify(removeMessage));
            addLog('ğŸ“Š ì „ì²´ êµ¬ë… í•´ì§€ ìš”ì²­', 'info');
        }

        // êµ¬ë… ì‘ë‹µ ì²˜ë¦¬
        function handleRegistrationResponse(data) {
            if (data.return_code === 0) {
                addLog(`âœ… ì¢…ëª© êµ¬ë… ì„±ê³µ: ${data.return_msg}`, 'success');
            } else {
                addLog(`âŒ ì¢…ëª© êµ¬ë… ì‹¤íŒ¨: ${data.return_msg}`, 'error');
            }
        }

        // í•´ì§€ ì‘ë‹µ ì²˜ë¦¬
        function handleRemovalResponse(data) {
            if (data.return_code === 0) {
                addLog(`âœ… êµ¬ë… í•´ì§€ ì„±ê³µ: ${data.return_msg}`, 'success');
            } else {
                addLog(`âŒ êµ¬ë… í•´ì§€ ì‹¤íŒ¨: ${data.return_msg}`, 'error');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì•ˆë‚´
        window.onload = function() {
            addLog('í‚¤ì›€ ì‹¤ì‹œê°„ ì‹œì„¸ WebSocket í…ŒìŠ¤íŠ¸ í˜ì´ì§€ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
            addLog('ì—°ê²° ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì‹¤ì‹œê°„ ì‹œì„¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.', 'info');
        };

        // í˜ì´ì§€ ì¢…ë£Œ ì‹œ WebSocket ì •ë¦¬
        window.onbeforeunload = function() {
            if (websocket) {
                websocket.close();
            }
        };
    </script>
</body>
</html>