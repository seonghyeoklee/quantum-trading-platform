<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout :: head}">
    <title>대시보드 - 퀀텀 트레이딩</title>
</head>
<body data-theme="light">
    <!-- Header -->
    <nav th:replace="~{layout :: header}"></nav>

    <!-- Sidebar -->
    <nav th:replace="~{layout :: sidebar}"></nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Breadcrumb -->
        <nav th:replace="~{layout :: breadcrumb}"></nav>

        <!-- Page Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="h3 mb-1">대시보드</h1>
                <p class="text-muted mb-0">시장 개요 및 시스템 상태를 확인하세요</p>
            </div>
            <div>
                <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#refreshModal">
                    <i class="bi bi-arrow-clockwise me-1"></i>
                    새로고침
                </button>
            </div>
        </div>

        <!-- Market Status Cards -->
        <div class="row mb-4">
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="small-box bg-info">
                    <div class="inner">
                        <h3>2,547.83</h3>
                        <p>KOSPI <span class="positive">+1.24%</span></p>
                    </div>
                    <div class="icon">
                        <i class="bi bi-graph-up"></i>
                    </div>
                    <a href="/stocks" class="small-box-footer">
                        자세히 보기 <i class="bi bi-arrow-right"></i>
                    </a>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="small-box bg-warning">
                    <div class="inner">
                        <h3>845.67</h3>
                        <p>KOSDAQ <span class="negative">-0.83%</span></p>
                    </div>
                    <div class="icon">
                        <i class="bi bi-graph-down"></i>
                    </div>
                    <a href="/stocks" class="small-box-footer">
                        자세히 보기 <i class="bi bi-arrow-right"></i>
                    </a>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="small-box bg-success">
                    <div class="inner">
                        <h3>₩15.2M</h3>
                        <p>포트폴리오 <span class="positive">+2.45%</span></p>
                    </div>
                    <div class="icon">
                        <i class="bi bi-wallet2"></i>
                    </div>
                    <a href="/orders" class="small-box-footer">
                        자세히 보기 <i class="bi bi-arrow-right"></i>
                    </a>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="small-box bg-primary">
                    <div class="inner">
                        <h3>127</h3>
                        <p>활성 주문 <span class="positive">+12</span></p>
                    </div>
                    <div class="icon">
                        <i class="bi bi-card-list"></i>
                    </div>
                    <a href="/orders" class="small-box-footer">
                        자세히 보기 <i class="bi bi-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>

        <!-- Charts Row -->
        <div class="row mb-4">
            <div class="col-lg-8 mb-3">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">
                            <i class="bi bi-graph-up me-2"></i>
                            시장 동향
                        </h5>
                        <div class="btn-group btn-group-sm" role="group">
                            <input type="radio" class="btn-check" name="chartPeriod" id="period1d" checked>
                            <label class="btn btn-outline-primary" for="period1d">1일</label>
                            <input type="radio" class="btn-check" name="chartPeriod" id="period1w">
                            <label class="btn btn-outline-primary" for="period1w">1주</label>
                            <input type="radio" class="btn-check" name="chartPeriod" id="period1m">
                            <label class="btn btn-outline-primary" for="period1m">1개월</label>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container" id="market-chart">
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <div class="text-muted">
                                    <div class="loading mb-2"></div>
                                    차트를 불러오는 중...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 mb-3">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="bi bi-pie-chart me-2"></i>
                            포트폴리오 분포
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container" id="portfolio-chart">
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <div class="text-muted">
                                    <div class="loading mb-2"></div>
                                    차트를 불러오는 중...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tables Row -->
        <div class="row mb-4">
            <div class="col-lg-6 mb-3">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">
                            <i class="bi bi-star me-2"></i>
                            관심 종목
                        </h5>
                        <a href="/stocks" class="btn btn-sm btn-outline-primary">
                            전체 보기 <i class="bi bi-arrow-right"></i>
                        </a>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover stock-table mb-0">
                                <thead>
                                    <tr>
                                        <th>종목명</th>
                                        <th>현재가</th>
                                        <th>등락률</th>
                                        <th>실시간</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="me-3">
                                                    <div class="stock-icon bg-primary">삼</div>
                                                </div>
                                                <div>
                                                    <div class="stock-name">삼성전자</div>
                                                    <div class="stock-symbol">005930</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="stock-price">₩76,400</td>
                                        <td>
                                            <span class="stock-change positive">+2.34%</span>
                                        </td>
                                        <td>
                                            <div class="real-time-indicator"></div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="me-3">
                                                    <div class="stock-icon bg-info">SK</div>
                                                </div>
                                                <div>
                                                    <div class="stock-name">SK하이닉스</div>
                                                    <div class="stock-symbol">000660</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="stock-price">₩142,500</td>
                                        <td>
                                            <span class="stock-change negative">-1.24%</span>
                                        </td>
                                        <td>
                                            <div class="real-time-indicator"></div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="me-3">
                                                    <div class="stock-icon bg-success">네</div>
                                                </div>
                                                <div>
                                                    <div class="stock-name">NAVER</div>
                                                    <div class="stock-symbol">035420</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="stock-price">₩158,500</td>
                                        <td>
                                            <span class="stock-change positive">+0.95%</span>
                                        </td>
                                        <td>
                                            <div class="real-time-indicator"></div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 mb-3">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">
                            <i class="bi bi-newspaper me-2"></i>
                            최신 뉴스
                        </h5>
                        <a href="/news" class="btn btn-sm btn-outline-primary">
                            전체 보기 <i class="bi bi-arrow-right"></i>
                        </a>
                    </div>
                    <div class="card-body">
                        <div class="list-group list-group-flush">
                            <div class="list-group-item d-flex justify-content-between align-items-start border-0 px-0">
                                <div class="me-3">
                                    <div class="fw-bold mb-1">삼성전자, 신규 반도체 공장 건설 발표</div>
                                    <small class="text-muted">15분 전</small>
                                </div>
                                <span class="badge bg-primary rounded-pill">중요</span>
                            </div>
                            <div class="list-group-item d-flex justify-content-between align-items-start border-0 px-0">
                                <div class="me-3">
                                    <div class="fw-bold mb-1">코스피, 장중 2,550 돌파... 외인 매수 지속</div>
                                    <small class="text-muted">32분 전</small>
                                </div>
                                <span class="badge bg-success rounded-pill">시장</span>
                            </div>
                            <div class="list-group-item d-flex justify-content-between align-items-start border-0 px-0">
                                <div class="me-3">
                                    <div class="fw-bold mb-1">AI 관련주 급등... 기관 매수 확대</div>
                                    <small class="text-muted">1시간 전</small>
                                </div>
                                <span class="badge bg-info rounded-pill">테마</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Status -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="bi bi-cpu me-2"></i>
                            시스템 상태
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <div class="d-flex align-items-center">
                                    <div class="status-indicator bg-success rounded-circle me-3" style="width: 12px; height: 12px;"></div>
                                    <div>
                                        <div class="fw-bold">KIS API</div>
                                        <small class="text-success">연결됨</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="d-flex align-items-center">
                                    <div class="status-indicator bg-success rounded-circle me-3" style="width: 12px; height: 12px;"></div>
                                    <div>
                                        <div class="fw-bold">데이터베이스</div>
                                        <small class="text-success">정상</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="d-flex align-items-center">
                                    <div class="status-indicator bg-warning rounded-circle me-3" style="width: 12px; height: 12px;"></div>
                                    <div>
                                        <div class="fw-bold">백테스팅 엔진</div>
                                        <small class="text-warning">대기중</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="d-flex align-items-center">
                                    <div class="status-indicator bg-success rounded-circle me-3" style="width: 12px; height: 12px;"></div>
                                    <div>
                                        <div class="fw-bold">뉴스 수집기</div>
                                        <small class="text-success">활성</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer th:replace="~{layout :: footer}"></footer>

    <!-- Refresh Modal -->
    <div class="modal fade" id="refreshModal" tabindex="-1">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">데이터 새로고침</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <div class="loading mb-3"></div>
                    <p>데이터를 업데이트하는 중입니다...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script th:src="@{/js/admin.js}"></script>

    <script>
        // 대시보드 전용 스크립트
        document.addEventListener('DOMContentLoaded', function() {
            // 새로고침 버튼 기능
            const refreshModal = document.getElementById('refreshModal');
            if (refreshModal) {
                refreshModal.addEventListener('show.bs.modal', function() {
                    setTimeout(function() {
                        location.reload();
                    }, 2000);
                });
            }

            // 차트 기간 변경 이벤트
            const periodButtons = document.querySelectorAll('input[name="chartPeriod"]');
            periodButtons.forEach(button => {
                button.addEventListener('change', function() {
                    console.log('Chart period changed to:', this.id);
                    // 여기서 차트 데이터 업데이트
                });
            });
        });
    </script>
</body>
</html>