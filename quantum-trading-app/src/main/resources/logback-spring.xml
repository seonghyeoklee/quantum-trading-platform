<?xml version="1.0" encoding="UTF-8"?>
<configuration>

    <!-- 색상 정의 -->
    <conversionRule conversionWord="clr" class="org.springframework.boot.logging.logback.ColorConverter" />
    <conversionRule conversionWord="wex" class="org.springframework.boot.logging.logback.WhitespaceThrowableProxyConverter" />
    <conversionRule conversionWord="wEx" class="org.springframework.boot.logging.logback.ExtendedWhitespaceThrowableProxyConverter" />

    <!-- Spring Boot 기본 패턴 사용 -->

    <!-- 콘솔 출력 (Spring Boot 기본 패턴) -->
    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>%clr(%d{${LOG_DATEFORMAT_PATTERN:-yyyy-MM-dd HH:mm:ss.SSS}}){faint} %clr(${LOG_LEVEL_PATTERN:-%5p}) %clr(${PID:- }){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}</pattern>
            <charset>UTF-8</charset>
        </encoder>
    </appender>

    <!-- 파일 출력 -->
    <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>logs/quantum-trading-app.log</file>
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread] %logger{50} : %msg%n</pattern>
            <charset>UTF-8</charset>
        </encoder>
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <fileNamePattern>logs/quantum-trading-app-%d{yyyy-MM-dd}-%i.log</fileNamePattern>
            <maxFileSize>100MB</maxFileSize>
            <maxHistory>30</maxHistory>
            <totalSizeCap>3GB</totalSizeCap>
        </rollingPolicy>
    </appender>

    <!-- KIS 전용 파일 로그 -->
    <appender name="KIS_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>logs/kis-api.log</file>
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread] %logger{50} : %msg%n</pattern>
            <charset>UTF-8</charset>
        </encoder>
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <fileNamePattern>logs/kis-api-%d{yyyy-MM-dd}-%i.log</fileNamePattern>
            <maxFileSize>50MB</maxFileSize>
            <maxHistory>15</maxHistory>
            <totalSizeCap>1GB</totalSizeCap>
        </rollingPolicy>
    </appender>

    <!-- 트랜잭션 전용 파일 로그 -->
    <appender name="TRANSACTION_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>logs/transactions.log</file>
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread] %logger{50} : %msg%n</pattern>
            <charset>UTF-8</charset>
        </encoder>
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <fileNamePattern>logs/transactions-%d{yyyy-MM-dd}-%i.log</fileNamePattern>
            <maxFileSize>50MB</maxFileSize>
            <maxHistory>15</maxHistory>
            <totalSizeCap>1GB</totalSizeCap>
        </rollingPolicy>
    </appender>

    <!-- ========== 애플리케이션 로거 ========== -->

    <!-- Quantum 패키지 (우리 비즈니스 로직) -->
    <logger name="com.quantum" level="DEBUG"/>

    <!-- SQL 쿼리 -->
    <logger name="org.hibernate.SQL" level="DEBUG"/>

    <!-- ========== 프레임워크 로거 ========== -->

    <!-- Spring Boot 핵심 -->
    <logger name="org.springframework.boot" level="INFO"/>
    <logger name="org.springframework.boot.web.embedded.tomcat" level="INFO"/>

    <!-- 데이터베이스 연결 -->
    <logger name="com.zaxxer.hikari.HikariDataSource" level="INFO"/>
    <logger name="org.hibernate.Version" level="INFO"/>

    <!-- ========== 노이즈 제거 ========== -->

    <!-- Hibernate 파라미터 바인딩 숨김 -->
    <logger name="org.hibernate.orm.jdbc.bind" level="OFF"/>
    <logger name="org.hibernate.type.descriptor.sql" level="OFF"/>

    <!-- 기타 불필요한 로그 -->
    <logger name="org.hibernate.orm.deprecation" level="OFF"/>
    <logger name="org.springframework.data.repository.query.QueryEnhancerFactory" level="OFF"/>
    <logger name="com.zaxxer.hikari.pool.HikariPool" level="OFF"/>

    <!-- ========== 루트 로거 ========== -->

    <root level="INFO">
        <appender-ref ref="CONSOLE"/>
        <appender-ref ref="FILE"/>
    </root>

</configuration>